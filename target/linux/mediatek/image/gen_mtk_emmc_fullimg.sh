#!/bin/sh

OUTPUT_FILE=$1

GPT_FILE=$2
PRELOADER_FILE=$3
ATF_FILE=$4
UBOOT_FILE=$5
KERNEL_FILE=$6
RECOVERY_FILE=$7
ROOTFS_FILE=$8


BS=512

GPT_OFFSET=0
PRELOADER_OFFSET=256
ATF_OFFSET=1024
UBOOT_OFFSET=1536
KERNEL_OFFSET=4096
RECOVERY_OFFSET=45056
ROOTFS_OFFSET=65537 


dd bs="$BS" of="$OUTPUT_FILE" if="$GPT_FILE" seek="$GPT_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$PRELOADER_FILE" seek="$PRELOADER_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$ATF_FILE" seek="$ATF_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$UBOOT_FILE" seek="$UBOOT_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$KERNEL_FILE" seek="$KERNEL_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$RECOVERY_FILE" seek="$RECOVERY_OFFSET"
dd bs="$BS" of="$OUTPUT_FILE" if="$ROOTFS_FILE" seek="$ROOTFS_OFFSET"
dd if=/dev/zero of="$OUTPUT_FILE" bs=128k count=1 oflag=append conv=notrunc
